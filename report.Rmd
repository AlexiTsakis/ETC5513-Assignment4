---
title: "Assignment 4 ggplot2"
author:
- familyname: Li
  othernames: Siyi
  address: Monash Universty
  email: "slii0048@student.monash.edu"
  correspondingauthor: true
  qualifications: 29018102
- familyname: Wang
  othernames: Yusen
  address: Monash Universty
  email: "ywa136@student.monash.edu"
  correspondingauthor: true
  qualifications: 27496538
- familyname: Tsakis
  othernames: Alexi
  address: Monash Universty
  email: "atsa0003@student.monash.edu"
  correspondingauthor: true
  qualifications: 29682525
department: Our consultancy \newline Alexi  &\newline Siyi  &\newline Yusen
organization: Australian Government
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    latex_engine: lualatex
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
    in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r , echo = FALSE, include=FALSE, message = FALSE, warning = FALSE}
# Libraries
set.seed(96024)

library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
```

```{r, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(fig.pos = 'H', echo = FALSE, message = FALSE, warning = FALSE)
```

{Section 1}

####Compulsory Seatbelts 1983

```{r, echo = FALSE, message = FALSE, warning = FALSE}
Seatbelts_data = data.frame(as.matrix(Seatbelts),date=time(Seatbelts))
```

```{r DriversKilled, fig.cap = "Drivers killed in accidents over time", echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data=Seatbelts_data, aes(x=date,y=DriversKilled,col=law))+geom_line()+geom_smooth()
```

```{r FrontKilled, fig.cap = "Frontseat passengers killed in accidents over time", echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data=Seatbelts_data, aes(x=date,y=front,col=law))+geom_line()+geom_smooth()
```

```{r RearKilled, fig.cap = "Backseat passengers killed in accidents over time", echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data=Seatbelts_data, aes(x=date,y=rear,col=law))+geom_line()+geom_smooth()
```

```{r VanKilled, fig.cap = "Light goods vehicle drivers killed in accidents over time", echo = FALSE, message = FALSE, warning = FALSE}
ggplot(data=Seatbelts_data, aes(x=date,y=VanKilled,col=law))+geom_line()+geom_smooth()
```

```{r DriverTable, echo = FALSE, message = FALSE, warning = FALSE}
Seatbelts_data %>%
  group_by(law) %>%
  summarise(DriversKilled_Average=mean(DriversKilled)) %>%
  kable(caption="Drivers killed before and after law")
```

```{r RearTable, echo = FALSE, message = FALSE, warning = FALSE}
Seatbelts_data %>%
  group_by(law) %>%
  summarise(Rear_Average=mean(rear)) %>%
  kable(caption="Back seat passengers killed before and after law")
```

```{r FrontTable, echo = FALSE, message = FALSE, warning = FALSE}
Seatbelts_data %>%
  group_by(law) %>%
  summarise(Front_Average=mean(front)) %>%
  kable(caption="Front seat passengers killed before and after law")
```

```{r VanTable, echo = FALSE, message = FALSE, warning = FALSE}
Seatbelts_data %>%
  group_by(law) %>%
  summarise(Van_Average=mean(VanKilled)) %>%
  kable(caption="Light good vehicle drivers killed before and after law")
```

In this section we look at the effect of seatbelts on driver deaths in the UK. Front seatbelts were compulsory on all new cars registered in the UK from 1968, however it was not required for them to be worn until 1983. In this section, we will answer the question - did mandatory wearing of frontrow seatbelts prevent deaths for drivers and passengers?

First, to answer if any relationships shown are causation and not simply correlation, we ask - why do seatbelts prevent deaths? According to the National Highway Traffic Safety Administration, the primary reasons why seatbelts prevent death is that "Buckling up helps keep you safe and secure inside your vehicle, whereas not buckling up can result in being totally ejected from the vehicle in a crash, which is almost always deadly." (NHTSA 2021)

These scenarios are referred to as "secondary collisions" - i.e. a crash event that results from the impact of an initial collison, such as ejection from a vehicle, or even a high speed impact with objects inside the vehicle.

Now that we understand the theory behind the impact of seatbelts on preventing death, let us look at the data:

There is a clear negative correlation between frontrow passengers and light good vehicle drivers killed since the introduction of the law (figure \@ref(fig:FrontKilled),  figure \@ref(fig:VanKilled)), data from the introduction of the law shown in blue).

There is also a clear reduction in number of drivers killed (figure \@ref(fig:DriversKilled)) since the introduction of compulsory seatbelts - the lack of change since the introduction of the law, but the large change since approximately 1973 can be described as " drivers that are least likely to use seat belts might be those that are more likely to be involved in an accident" (Cohen, A. and Einav. L 2003) - i.e. that careful drivers adopted seatbelts already without the law, and those likely to get involved in accidents would be unlikely to wear seatbelts even with the law in place.

There is little change in number of rear seat passengers killed (figure \@ref(fig:RearKilled)) - this is because the regulations and law were only for front seat seatbelts, and not backseat seatbelts, suggesting the total number of accidents didn't change.

We can also see this in tabular format, so it is easier to see the effect of the law numerically (table \@ref(tab:DriverTable), table \@ref(tab:RearTable), table \@ref(tab:FrontTable), table \@ref(tab:VanTable)).

\clearpage


{Section 2}

```{r, message=FALSE, warning=FALSE}
library(ggplot2)
library(GGally)
library(tidyverse)
library(readr)
library(broom)
```

```{r get-data}
Seatbelts%>%as.data.frame()->seatbelts
```
# Reaseach Questions

- Is there any relationship between the DriversKilled variable and other variables?

- Can we build an model among these variables?


# Analysis
## Is there any relationship between the DriversKilled variable and other variables?

```{r mytables, message=FALSE, warning=FALSE, fig.align='center', fig.pos="H"}
seatbelts%>%
  select("DriversKilled", "drivers", "front")%>%
  summary()%>%
  kable(caption = "Summary of the three variabls")
```
From the table \@ref(tab:mytables) shows:

- the minimum number of drivers killed is 60 and the maximum is 198. 

- the minimum number of drivers is 1057 and the maximum is 2654. 

- the minimum number of front-seat passengers killed or seriously injured is 426 and the maximum is 1299.

- when the number of the drivers increase, the number of the drivers killed also increase. Therefore, I guess there is a positive relationship between the variable drivers and the variable drivers killed.
 
In order to develop the relationship between the number of drivers and car drivers killed, we can use GGally package (\cite{10}) to produce the correlation graph.

```{r myggpair, warning=FALSE, message=FALSE, fig.cap = "Correlation between variables", fig.align='center'}
seatbelts%>% 
  ggpairs()+
  ggtitle("Correlation between variables")+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

- The figure \@ref(fig:myggpair) shows that there are positive relationships between drivers variable and Driverskilled variable, front variable and Driverskilled variable, VanKilled and Driverskilled, rear variable and Driverskilled variable. Especially, we can see that the variables of front and drivers are highly positive related to the Driverskilled variable since the correlations between that are 0.707 and 0.889 respectively.

- It also indicates that the relationships between kms and Driverskilled variable, PetrolPrice and Driverskilled, and law and Driverskilled are negative.



## Can we build an model among these variables?

```{r model,message=FALSE, warning=FALSE}
Seatbelts%>%as.data.frame()->seatbelts
seatbelts%>%
  mutate(law=as.factor(law))->Seatbelt

fit<-lm(DriversKilled ~ ., data=Seatbelt)
summary(fit)
```

The linear model shows that just the drivers variable are significant which means that the drivers are fit the model. Other variables include the Intercept are not significant since their p-value are larger than 0.05, which means that the model can not fit all the variables very well.

\clearpage

```{r, message=FALSE, warning=FALSE}
aug<-augment(fit)
```


```{r redsduals, message=FALSE, warning=FALSE, fig.cap="residuals VS fitted value"}
ggplot(aug, aes(x=.fitted, y=.resid))+
  geom_point()+
  geom_smooth()+
   geom_hline(yintercept=0, color="red")+
  ggtitle("residuals VS fitted value")
```

In order to analyze the residuals, I use the **broom** package(\cite{11}).

From the figure \@ref(fig:redsduals), it indicates that the residuals does not include obvious pattern of the variables since the residuals are randomly around the red line. It means that the model can capture most information about the response variable DriversKilled. But we can see that the tail at the beginning and end is not like a straight since the observations are not enough at the end and the beginning.

{Section 3}
